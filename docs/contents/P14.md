## Django 5.0 版本新特性

将 Django 5.0 视为熟悉的 Django 4.0 的颠覆性升级。它为我们的网络开发工具库中本已不可或缺的工具注入了新的活力。此更新通过引入与最新 Python 版本的兼容性和大量令人惊叹的新功能，确保 Django 跟上技术的快速进步。让我们深入研究细节：Django 5.0 准备以最显着的方式彻底改变我们的 Web 开发体验。 


1.Python 兼容性
Django 5.0 支持 Python 3.10、3.11 和 3.12。我们强烈推荐并仅官方支持每个系列的最新版本。Django 4.2.x 系列是最后一个支持 Python 3.8 和 3.9 的版本。

Django 5.0 发布后，我们建议第三方应用程序作者放弃对 Django 4.2 之前的所有版本的支持。那时，您应该能够使用运行包的测试，以便出现弃用警告。修复弃用警告后，您的应用程序应该与 Django 5.0 兼容。

2.管理中的面板滤器
由于引入了面板过滤器，在 Django 管理界面中管理数据现在比以往任何时候都更容易。通过用户界面开启后，管理更改列表中会显示已应用过滤器的面板计数。该功能可使用新的 ModelAdmin.show_facets 属性进行自定义，从而为用户提供更直观的方式来筛选和探索数据。

3.表单字段渲染的简化模板
Django 5.0 引入了 "字段组" 和字段组模板的概念，简化了 Django 表单字段的渲染。这种简化大大减少了渲染表单元素所需的 HTML 和模板代码量，使您的模板更简洁、更易于维护。

例如下面的模板：

```html
<form>
...
<div>
  {{ form.name.label_tag }}
  {% if form.name.help_text %}
    <div class="helptext" id="{{ form.name.id_for_label }}_helptext">
      {{ form.name.help_text|safe }}
    </div>
  {% endif %}
  {{ form.name.errors }}
  {{ form.name }}
  <div class="row">
    <div class="col">
      {{ form.email.label_tag }}
      {% if form.email.help_text %}
        <div class="helptext" id="{{ form.email.id_for_label }}_helptext">
          {{ form.email.help_text|safe }}
        </div>
      {% endif %}
      {{ form.email.errors }}
      {{ form.email }}
    </div>
    <div class="col">
      {{ form.password.label_tag }}
      {% if form.password.help_text %}
        <div class="helptext" id="{{ form.password.id_for_label }}_helptext">
          {{ form.password.help_text|safe }}
        </div>
      {% endif %}
      {{ form.password.errors }}
      {{ form.password }}
    </div>
  </div>
</div>
...
</form>
```
现在可以简化为:

```html
<form>
...
<div>
  {{ form.name.as_field_group }}
  <div class="row">
    <div class="col">{{ form.email.as_field_group }}</div>
    <div class="col">{{ form.password.as_field_group }}</div>
  </div>
</div>
...
</form>
```
4.数据库计算的默认值
有了新的 "Field.db_default" 参数，为模型字段设置数据库计算的默认值变得更容易了。此功能允许您使用数据库函数定义默认值，从而在定义模型默认值时提供更大的灵活性和更高的精确度。

例如:

```python
from django.db import models
from django.db.models.functions import Now, Pi

class MyModel(models.Model):
    age = models.IntegerField(db_default=18)
    created = models.DateTimeField(db_default=Now())
    circumference = models.FloatField(db_default=2 * Pi())
```
5.数据库生成的模型字段
新的 GeneratedField 使开发人员能够在 Django 模型中创建数据库生成的列。该字段可根据模型中的其他字段计算其值，从而简化复杂的计算并确保数据库级别的数据完整性。

例如:

```python
from django.db import models
from django.db.models import F

class Square(models.Model):
    side = models.IntegerField()
    area = models.GeneratedField(expression=F("side") * F("side"), db_persist=True)
```
6.Django 5.0 还提升了处理模型字段中的选择的能力。
在 Django 的早期版本中，Field.choices 应该是二元组列表，或者是枚举类型子类。Django 5.0支持使用映射或可调用对象（而不仅仅是可迭代对象）进行字段选择的选项开辟了动态和上下文响应字段选项的全新领域。

```python
from django.db import models


Medal = models.TextChoices("Medal", "GOLD SILVER BRONZE")


SPORT_CHOICES = {  # Using a mapping instead of a list of 2-tuples.
    "Martial Arts": {"judo": "Judo", "karate": "Karate"},
    "Racket": {"badminton": "Badminton", "tennis": "Tennis"},
    "unknown": "Unknown",
}
```